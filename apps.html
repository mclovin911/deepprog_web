<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DeepProg web apps alpha</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link href="css/animate.min.css" rel="stylesheet">
    <link href="css/prettyPhoto.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
	<link href="css/responsive.css" rel="stylesheet">
    <style>
      img {
      vertical-align: initial;
      border-style: none;
      }
    </style>
	 <!--[if lt IE 9]>
             <script src="js/html5shiv.js"></script>
             <script src="js/respond.min.js"></script>
             <![endif]-->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  </head>

  <body class="homepage">
	<header id="header">
          <nav class="navbar navbar-fixed-top" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">DeepProg Experimental WebApps</a>
                </div>

                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="/">Home</a></li>
                        <!-- <li><a href="/action_hcc">HCC model</a></li> -->
                        <!-- <li><a href="/action_brca">BRCA model</a></li> -->
                        <li><a href="portfolio.html">Portfolio</a></li>
                        <li><a href="contact-us.html">Contact</a></li>
                    </ul>
                </div>
            </div><!--/.container-->
              {% if  main_apps.logs[cancer] %}
                <div class="container" id="logbar" style="overflow-y: scroll; height:120px">
                  {% for log in main_apps.logs[cancer]|reverse %}
                    <a class="navbar-brand">{{ log }}</a>
                  {% endfor %}
                </div>
              {% endif %}

        </nav><!--/nav-->

    </header><!--/header-->
        {% set deepprog = main_apps.cancer_dict[cancer] %}
	<section id="feature" style={{ "width:1900px;" if main_apps.predicted_any[cancer] else "" }}>
          <div class="container" style={{ "width:1900px;" if main_apps.predicted_any[cancer] else "" }}>
          <div class="center wow fadeInDown">
            <br><br><br><br><br><br><br>
                <h2>{{ deepprog.cancer_type }} models</h2>
            </div>
            <div class="training" style={{ "width:1900px;" if main_apps.predicted_any[cancer] else "width:1200px;" }}>
              {% for dataset in main_apps.cancer_dict[cancer].training_tsvs %}
                <div id="{{ dataset }}_raw">
                  <h1><font color="black">DeepProg model for {{ dataset }}</font></h1>
                  <p class="{{ dataset }}"></p>
                  <table>
                    <tr><th><h4><b><center>Training survival plot</center></b></h4></th>
                      <th><h4><b><center>Training kernel plot</center></b></h4></th>
                      {% if main_apps.predicted[cancer][dataset] %}
                        <th><h4><b><center>Test sample results</center></b></h4></th>
                      {% endif %}
                    </tr>
                    <tr><th>
                        <img src="deepprog_results/{{ dataset }}/{{ dataset }}_KM_plot_boosting_full.jpg"
                             style="width:680px; height:680px;">
                      </th>
                      <th><img src="/deepprog_results/{{ dataset }}/{{ dataset }}_STAD_KM_plot_boosting_test.jpg"
                                  style="width:680px; height:680px;">
                      </th>
                      {% if main_apps.predicted[cancer][dataset] %}
                        <th><iframe
                              src="~/code/deepprog_webapps/deepprog_webapps/deepprog_results/{{ dataset }}/{{ dataset }}_{{ main_apps.predicted[cancer][dataset] }}_supervised_test_kdeplot.html"
                              style="width:680px; height:680px;" allowfullscreen>
                          </iframe>
                        </th>
                      {% endif %}
                    </tr>
                    {% if main_apps.predicted[cancer][dataset] %}
                      <tr>
                        <th></th><th></th>
                        <th>
                          <center>
                            <h3>Test survival plot</h3>
                            <div class="row">
                              <div>
                                <div class="recent-work-wrap">
                                  <img class="img-responsive" src="/deepprog_results/{{ dataset }}/{{ dataset }}_{{ main_apps.predicted[cancer][dataset] }}_KM_plot_boosting_test.pdf" alt="" style="width:400px; height:200px;">
                                  <div class="overlay">
                                    <div class="recent-work-inner">
                                      <h3><a href="#">Test survival plot</a> </h3>
                                      <a class="preview"
                                         href="/deepprog_results/{{ dataset }}/{{ dataset }}_{{ main_apps.predicted[cancer][dataset] }}_KM_plot_boosting_test.pdf"
                                         rel="prettyPhoto"><i class="fa fa-eye"></i> View</a>

                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </center>
                          {# ################ new surv plto! #}

                        </th>
                      </tr>
                    {% endif %}
                  </table>
                  {% if main_apps.ready_to_test[cancer] %}
                    {# <form> #}
                      <br>
                      <input class="btn btn-lg btn-success"
                             id="Submit_{{ dataset }}"
                             value="Submit {{ dataset }}"
                             type="submit"
                             role="button">
                    {# </form> #}
                  {% endif %}
                  </div>
                {% endfor %}
            </div><!--/.row-->
        </div><!--/.container-->
</section><!--/#feature-->








<div class="container">
  <div class="center wow fadeInDown">
    <section id="form"><!--/#form-->
      <br>
      <br>
  <h2><center><b>Drop your own sample!</b></center></h2>
  <form method="POST" enctype="multipart/form-data">
  	<label for='rna_file'> RNA file: </label>
  	<input type='file' id='rna_file' name='rna_file'> <br><br>
    <label for='mir_file'> MIR file: </label>
    <input type='file' id='mir_file' name='mir_file'> <br><br>
    <label for='meth_file'> METH file: </label>
    <input type='file' id='meth_file' name='meth_file'> <br><br>
  	<label for='test_name'> Test Name: </label>
  	<input type='text' id='test_name' name='test_name'> <br><br>
    <!-- <input class="btn btn-lg btn-success" value="Submit TEST" type="submit" role="button"> -->
    <button id="upload-file-btn" type="button">Submit</button>
  </form>
    </section>
  </div>
</div>
         <br>
         <br>
         <br>
    <section id="middle">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 wow fadeInDown">
                    <div class="skill">
                      <h2>Our cancer types</h2>
                      <p>Number of training datasets per cancer type.</p>
                      {% set count = 1 %}
                        {% for key in main_apps.cancer_dict %}
                          <div class="progress-wrap">
                            <h3>{{ main_apps.cancer_dict[key].key.upper() }}</h3>
                            <div class="progress">
                              <div class="progress-bar  color{{ count }}" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                <span class="bar-width">{{ main_apps.cancer_dict[key].training_tsvs|length }}</span>
                              </div>
                            </div>
                          </div>
                          {% set count = count + 1 %}
                      {% endfor %}

                </div><!--/.col-sm-6-->

                <div class="col-sm-6 wow fadeInDown">
                    <div class="accordion">
                        <h2>About DeepProg</h2>
                        <div class="panel-group" id="accordion1">
                          <div class="panel panel-default">
                            <div class="panel-heading active">
                              <h3 class="panel-title">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#collapseOne1">
                                  Garmire Lab
                                  <i class="fa fa-angle-right pull-right"></i>
                                </a>
                              </h3>
                            </div>

                            <div id="collapseOne1" class="panel-collapse collapse in">
                              <div class="panel-body">
                                  <div class="media accordion-inner">
                                        <div class="pull-left">
                                            <img class="img-responsive" src="images/garmire-lana.jpg">
                                        </div>
                                        <div class="media-body">
                                             <h4>Focus of the garmire lab</h4>
                                             <p>dep learning single-cell</p>
                                        </div>
                                  </div>
                              </div>
                            </div>
                          </div>

                    </div>
                </div>

            </div><!--/.row-->
        </div><!--/.container-->
    </section><!--/#middle-->

	<section id="bottom">
        <div class="container wow fadeInDown" data-wow-duration="1000ms" data-wow-delay="600ms">
            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <div class="widget">
                        <h3>Garmire lab</h3>
                        <ul>
                            <li><a href="#">About us</a></li>
                            <li><a href="#">We are hiring</a></li>
                            <li><a href="#">Meet the team</a></li>
                            <li><a href="#">Copyright</a></li>
                        </ul>
                    </div>
                </div><!--/.col-md-3-->

            </div>
        </div>
    </section><!--/#bottom-->

	<div class="top-bar">
		<div class="container">
			<div class="row">
			    <div class="col-lg-12">
				   <div class="social">
						<ul class="social-share">
							<li><a href="#"><i class="fa fa-facebook"></i></a></li>
							<li><a href="#"><i class="fa fa-twitter"></i></a></li>
							<li><a href="#"><i class="fa fa-linkedin"></i></a></li>
							<li><a href="#"><i class="fa fa-dribbble"></i></a></li>
							<li><a href="#"><i class="fa fa-skype"></i></a></li>
						</ul>
				   </div>
                </div>
			</div>
		</div><!--/.container-->
	</div><!--/.top-bar-->

	<footer id="footer" class="midnight-blue">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    &copy; 2015 <a target="_blank" href="http://bootstraptaste.com/" title="Free Twitter Bootstrap WordPress Themes and HTML templates">bootstraptaste</a>. All Rights Reserved.
                </div>
                <!--
                    All links in the footer should remain intact.
                    Licenseing information is available at: http://bootstraptaste.com/license/
                    You can buy this theme without footer links online at: http://bootstraptaste.com/buy/?theme=Gp
                -->
                <div class="col-sm-6">
                    <ul class="pull-right">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Faq</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer><!--/#footer-->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
      setInterval(function()
      {$.get("/predicted/{{ cancer }}", function(data) {
      console.log(data);
      if (data.reload_logs == true) {
      $("#logbar").load(" #logbar");
      };
      $.each(data.reload, function(index, model) {
      console.log("#" + model);
      $("#" + model + "_raw").load(" #" + model + "_raw");
      })

      })}, 1000);
</script>


<!-- The Result -->
<div id="results" class="result_class">

  <!-- Modal content -->
  <div class="result-content">
    <span id='result_bye' class="close">&times;</span>
    <p id=result_list> </p>
  </div>

</div>


<script>
var popup = document.getElementById("results");
var btn = document.getElementById("see_result");
btn.onclick = function() {
  popup.style.display = "block";
}

var bye = document.getElementsById("result_bye");
bye.onclick = function() {
  popup.style.display = "none";
}
window.onclick = function(event) {
  if (event.target == popup) {
    popup.style.display = "none";
  }
}
</script>



<script type=text/javascript>
  $(function() {
    $('#upload-file-btn').click(function() {
        var form_data = new FormData(); 
        form.append("rna_file", $("#rna_file").prop('files'));
        form.append("mir_file", $("#mir_file").prop('files'));
        form.append("meth_file", $("#meth_file").prop('files'));
        form.append("test_name", $("#test_name").val());
        $.ajax({
            type: 'POST',
            url: '/get_result',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            success: function(data) {
              $("#result_list").text(data.results);
            },
        });
    });
});
</script>

















    {% for dataset in main_apps.cancer_dict[cancer].training_tsvs %}
<script>
  $(document).ready(function(){

  $("#Submit_{{ dataset }}").click(function(){
  console.log("#Submit_{{ dataset }} clicked");
  $.ajax({
      type: "POST",
      url: "/predict/{{ deepprog.key }}/{{ dataset }}",
      cache: false,
      {# success: function(result){alert(result);} #}
      });
   });
  });
</script>
{% endfor %}
  </body>
</html>
